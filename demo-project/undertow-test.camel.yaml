- restConfiguration:
    component: platform-http
    contextPath: /api
- rest:
    id: rest-test
    bindingMode: json
    delete:
      - id: delete-jira
        path: /jira/delete
        to: direct:jira-delete
    get:
      - id: get-test
        path: /users
        to: direct:direct-test
      - id: get-8fd3
        path: /jira/addcomment
        to: direct:jira-addcomment
    post:
      - id: get-8fd2
        path: /jira/addissue
        to: direct:jira-addissue
      - id: get-8fd3
        path: /jira/addissue/cpu
        to: direct:jira-increase-cpu
      - id: post-attach
        path: /jira/attach
        to: direct:jira-attach
      - id: get-8fd4
        path: /jira/transition
        to: direct:jira-transition
      - id: get-webhook
        path: /jira/webhook
        to: direct:direct-webhook
      - id: get-webhook-1
        path: >-
          /nutanix/v3/blueprints/5d1d4765-f94e-abcb-6d82-7377046d0f24/simple_launch
        to: direct:direct-launcbp
      - id: get-webhook-2
        path: /nutanix/v3/action_rules/trigger
        to: direct:direct-trigger-playbook
- route:
    id: route-test
    nodePrefixId: route-123
    from:
      id: direct-id
      uri: direct
      parameters:
        name: direct-test
      steps:
        - to:
            id: to-9250
            uri: undertow
            parameters:
              httpURI: https://jsonplaceholder.typicode.com/users?bridgeEndpoint=true
- route:
    id: jira-addissue
    from:
      id: from-ae7e
      uri: direct
      parameters:
        name: jira-addissue
      steps:
        - setHeader:
            id: setHeader-17f3
            name: ProjectKey
            expression:
              simple:
                id: simple-0187
                expression: PEG
        - setHeader:
            id: setHeader-d55e
            name: IssueTypeName
            expression:
              simple:
                id: simple-78d2
                expression: Task
        - setHeader:
            id: setHeader-c33a
            name: IssueSummary
            expression:
              simple:
                id: simple-c612
                expression: >-
                  Create VM : ${body[name]} Created Date : ${date:now:yyyy-MM-dd
                  HH:mm:ss}
        - setBody:
            id: setBody-e4af
            expression:
              simple:
                id: simple-10f4
                expression: >-
                  Detail VM: VM Name = ${body[vm_name]}, Project Name =
                  ${body[project_name]}, Bp template = rocky 8, Size =
                  ${body[size]}
        - to:
            id: to-5ea6
            uri: jira
            parameters:
              type: addIssue
              jiraUrl: https://pocntnx46.atlassian.net
              username: pocntnx46@gmail.com
              password: ATATT3xFfGF05jNpO5UIVOGVn6oNwTIUoAj2HaRdtx0vdTc_4_jLIDiaahbkGqMatrWcX7cx39oTAKQniWMPTEHmTn0VMjmOQLgAH73waONyEr1b5EHM6MthCzK_CuFVr2t7INfib4VyDpqmeMCLI0ocZA4kckMwp-TvEsexTKYuhtF_NXUtsF8=F99178F0
        - setHeader:
            id: setResponseCode
            name: CamelHttpResponseCode
            expression:
              constant:
                id: constant-8a55
                expression: "200"
        - log:
            id: log-e145
            message: "Issue created: ${body}"
- route:
    id: jira-increase-cpu
    from:
      id: from-6cb8
      uri: direct
      parameters:
        name: jira-increase-cpu
      steps:
        - setHeader:
            id: setHeader-2312
            name: ProjectKey
            expression:
              simple:
                id: simple-d22f
                expression: PEG
        - setHeader:
            id: setHeader-b062
            name: IssueTypeName
            expression:
              simple:
                id: simple-258a
                expression: Task
        - setHeader:
            id: setHeader-b35c
            name: IssueSummary
            expression:
              simple:
                id: simple-c612
                expression: >-
                  Increase CPU VM ID : ${body[name]} on ${date:now:yyyy-MM-dd
                  HH:mm:ss}
        - setBody:
            id: setBody-2efd
            expression:
              simple:
                id: simple-e436
                expression: >-
                  Detail Request : VM Name = ${body[name]}, IP = ${body[ip]},
                  Playbook ID : ${body[id]}, Allert UUID : ${body[alert_uuid]},
                  Allert Name : ${body[alert_name]}
        - to:
            id: to-fdfa
            uri: jira
            parameters:
              type: addIssue
              jiraUrl: https://pocntnx46.atlassian.net
              username: pocntnx46@gmail.com
              password: ATATT3xFfGF05jNpO5UIVOGVn6oNwTIUoAj2HaRdtx0vdTc_4_jLIDiaahbkGqMatrWcX7cx39oTAKQniWMPTEHmTn0VMjmOQLgAH73waONyEr1b5EHM6MthCzK_CuFVr2t7INfib4VyDpqmeMCLI0ocZA4kckMwp-TvEsexTKYuhtF_NXUtsF8=F99178F0
        - setHeader:
            id: setHeader-86c5
            name: CamelHttpResponseCode
            expression:
              constant:
                id: constant-b30b
                expression: "200"
        - log:
            id: log-312e
            message: "Increase CPU Issue: ${body}"
- route:
    id: jira-addcomment
    from:
      id: from-5d61
      uri: direct
      parameters:
        name: jira-addcomment
      steps:
        - setHeader:
            id: setHeader-17f4
            name: IssueKey
            expression:
              simple:
                id: simple-0187
                expression: PEG-2
        - setBody:
            id: setBody-8e30
            expression:
              constant:
                id: constant-10f4
                expression: Testing Comment dulu aja.
        - to:
            id: to-b9c8
            uri: jira
            parameters:
              type: addComment
              jiraUrl: https://pocntnx46.atlassian.net
              username: pocntnx46@gmail.com
              password: ATATT3xFfGF05jNpO5UIVOGVn6oNwTIUoAj2HaRdtx0vdTc_4_jLIDiaahbkGqMatrWcX7cx39oTAKQniWMPTEHmTn0VMjmOQLgAH73waONyEr1b5EHM6MthCzK_CuFVr2t7INfib4VyDpqmeMCLI0ocZA4kckMwp-TvEsexTKYuhtF_NXUtsF8=F99178F0
        - log:
            id: log-4e91
            message: "Issue created: ${body}"
- route:
    id: jira-attach
    from:
      id: from-edae
      uri: direct
      parameters:
        name: jira-attach
      steps:
        - setHeader:
            id: setHeader-351f
            name: IssueKey
            expression:
              simple:
                id: simple-1ada
                expression: PEG-2
        - to:
            id: to-07ba
            uri: jira
            parameters:
              type: attach
              jiraUrl: https://pocntnx46.atlassian.net
              username: pocntnx46@gmail.com
              password: ATATT3xFfGF05jNpO5UIVOGVn6oNwTIUoAj2HaRdtx0vdTc_4_jLIDiaahbkGqMatrWcX7cx39oTAKQniWMPTEHmTn0VMjmOQLgAH73waONyEr1b5EHM6MthCzK_CuFVr2t7INfib4VyDpqmeMCLI0ocZA4kckMwp-TvEsexTKYuhtF_NXUtsF8=F99178F0
        - log:
            id: log-13f1
            message: "Issue created: ${body}"
- route:
    id: jira-transition
    from:
      id: from-cdf0
      uri: direct
      parameters:
        name: jira-transition
      steps:
        - setHeader:
            id: setHeader-6f92
            name: IssueKey
            expression:
              simple:
                id: simple-3c83
                expression: ${body[cardId]}
        - setHeader:
            id: setHeader-7f5d
            name: IssueTransitionId
            expression:
              simple:
                id: simple-d9f7
                expression: "5"
        - setBody:
            id: setBody-ddfb
            expression:
              constant:
                id: constant-e1e9
                expression: On create VM transition to Done.
        - to:
            id: to-0e69
            uri: jira
            parameters:
              type: transitionIssue
              jiraUrl: https://pocntnx46.atlassian.net
              username: pocntnx46@gmail.com
              password: ATATT3xFfGF05jNpO5UIVOGVn6oNwTIUoAj2HaRdtx0vdTc_4_jLIDiaahbkGqMatrWcX7cx39oTAKQniWMPTEHmTn0VMjmOQLgAH73waONyEr1b5EHM6MthCzK_CuFVr2t7INfib4VyDpqmeMCLI0ocZA4kckMwp-TvEsexTKYuhtF_NXUtsF8=F99178F0
        - log:
            id: log-7341
            message: "transition : ${body}"
- route:
    id: jira-delete
    from:
      id: from-fc7d
      uri: direct
      parameters:
        name: jira-delete
      steps:
        - setHeader:
            id: setHeader-4d9c
            name: IssueKey
            expression:
              simple:
                id: simple-47e3
                expression: PEG-2
        - to:
            id: to-23f1
            uri: jira
            parameters:
              type: deleteIssue
              jiraUrl: https://pocntnx46.atlassian.net
              username: pocntnx46@gmail.com
              password: ATATT3xFfGF05jNpO5UIVOGVn6oNwTIUoAj2HaRdtx0vdTc_4_jLIDiaahbkGqMatrWcX7cx39oTAKQniWMPTEHmTn0VMjmOQLgAH73waONyEr1b5EHM6MthCzK_CuFVr2t7INfib4VyDpqmeMCLI0ocZA4kckMwp-TvEsexTKYuhtF_NXUtsF8=F99178F0
        - log:
            id: log-37c4
            message: "delete : ${body}"
- route:
    id: jira-update
    from:
      id: from-5bf8
      uri: direct
      parameters:
        name: jira-update
      steps:
        - setHeader:
            id: setHeader-ec46
            name: IssueKey
            expression:
              simple:
                id: simple-e7df
                expression: PEG-2
        - to:
            id: to-5371
            uri: jira
            parameters:
              type: updateIssue
              jiraUrl: https://pocntnx46.atlassian.net
              username: pocntnx46@gmail.com
              password: ATATT3xFfGF05jNpO5UIVOGVn6oNwTIUoAj2HaRdtx0vdTc_4_jLIDiaahbkGqMatrWcX7cx39oTAKQniWMPTEHmTn0VMjmOQLgAH73waONyEr1b5EHM6MthCzK_CuFVr2t7INfib4VyDpqmeMCLI0ocZA4kckMwp-TvEsexTKYuhtF_NXUtsF8=F99178F0
        - log:
            id: log-60ad
            message: "update : ${body}"
- route:
    id: jira-watch-create-issue
    from:
      id: from-f17e
      uri: jira
      parameters:
        jiraUrl: https://pocntnx46.atlassian.net
        username: pocntnx46@gmail.com
        password: ATATT3xFfGF05jNpO5UIVOGVn6oNwTIUoAj2HaRdtx0vdTc_4_jLIDiaahbkGqMatrWcX7cx39oTAKQniWMPTEHmTn0VMjmOQLgAH73waONyEr1b5EHM6MthCzK_CuFVr2t7INfib4VyDpqmeMCLI0ocZA4kckMwp-TvEsexTKYuhtF_NXUtsF8=F99178F0
        type: newIssues
        jql: project=PEG
      steps:
        - log:
            id: log-0920
            message: "watch card : ${body}"
- route:
    id: jira-watch-update
    from:
      id: from-f17e
      uri: jira
      parameters:
        jiraUrl: https://pocntnx46.atlassian.net
        username: pocntnx46@gmail.com
        password: ATATT3xFfGF05jNpO5UIVOGVn6oNwTIUoAj2HaRdtx0vdTc_4_jLIDiaahbkGqMatrWcX7cx39oTAKQniWMPTEHmTn0VMjmOQLgAH73waONyEr1b5EHM6MthCzK_CuFVr2t7INfib4VyDpqmeMCLI0ocZA4kckMwp-TvEsexTKYuhtF_NXUtsF8=F99178F0
        type: watchUpdates
        jql: project=PEG
      steps:
        - log:
            id: log-1003
            message: "watch card : ${body}"
- route:
    id: jira-webhook
    from:
      id: from-6c2e
      uri: direct
      parameters:
        name: direct-webhook
      steps:
        - to:
            id: to-45aa
            uri: kamelet:json-serialize-action
        - to:
            id: to-b9cf
            uri: kamelet:json-deserialize-action
        - process:
            id: process-bd01
            ref: SetValueProcessor
        - choice:
            id: choice-71f9
            description: check if the card transition from create vm to done
            when:
              - id: when-3e0asdf
                expression:
                  simple:
                    id: simple-ac67
                    expression: ${header.isComplete} == 'true'
                steps:
                  - setHeader:
                      id: setHeader-f480
                      name: Content-Type
                      expression:
                        simple:
                          id: simple-cdb1
                          expression: application/json
                  - setHeader:
                      id: setHeader-3de3
                      name: Accept
                      expression:
                        simple:
                          id: simple-9956
                          expression: application/json
                  - setHeader:
                      id: setHeader-f805
                      name: Authorization
                      expression:
                        simple:
                          id: simple-6319
                          expression: Basic Ym90LWNhbG06VGFiZWxkYXRhLzR1
                  - removeHeader:
                      id: removeHeader-9bfa
                      name: CamelHttpPath
                  - log:
                      id: log-bd25
                      message: "Webhook Test : ${body[]}"
                  - choice:
                      id: choice-ef15
                      description: check if the card is for increasing vm cpu
                      when:
                        - id: when-809b
                          expression:
                            simple:
                              id: simple-3c91
                              expression: ${header.isIncrease} == 'true'
                          steps:
                            - process:
                                id: process-6464
                                ref: IncreaseCpuProcessor
                            - to:
                                id: to-5d50
                                uri: netty-http
                                parameters:
                                  protocol: https
                                  host: 192.168.100.51
                                  port: "9440"
                                  path: api/nutanix/v3/action_rules/trigger
                                  bridgeEndpoint: true
                      otherwise:
                        id: otherwise-cf67
                        steps:
                          - process:
                              id: process-58e6
                              ref: TestingProcessor
                          - to:
                              id: to-0766
                              uri: netty-http
                              parameters:
                                protocol: https
                                host: 192.168.100.51
                                port: "9440"
                                path: >-
                                  api/nutanix/v3/blueprints/5d1d4765-f94e-abcb-6d82-7377046d0f24/simple_launch
                                bridgeEndpoint: true
            otherwise:
              id: otherwise-b58e
              steps:
                - log:
                    id: log-a2d1
                    message: KOSYONG GAES
- route:
    id: nutanix-trigger-playbook
    from:
      id: from-5810
      uri: direct
      parameters:
        name: direct-trigger-playbook
      steps:
        - setHeader:
            id: setHeader-f9f3
            name: Accept
            expression:
              simple:
                id: simple-57b8
                expression: application/json
        - setHeader:
            id: setHeader-cc83
            name: Authorization
            expression:
              simple:
                id: simple-9398
                expression: Basic Ym90LWNhbG06VGFiZWxkYXRhLzR1
        - setHeader:
            id: setHeader-acdf
            name: Content-Type
            expression:
              simple:
                id: simple-c53d
                expression: application/json
        - process:
            id: process-b224
            ref: IncreaseCpuProcessor
        - to:
            id: to-777f
            uri: log
            parameters:
              loggerName: DEBUG?showBody=true&showHeaders=true
        - to:
            id: to-fa73
            uri: netty-http
            parameters:
              bridgeEndpoint: true
              protocol: https
              host: 192.168.100.51
              port: "9440"
              reuseAddress: false
